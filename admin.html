<!DOCTYPE html>
<html lang="en">

<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>Portfolio Admin Dashboard</title>
   <link rel="stylesheet" href="style.css">
   <link rel="preconnect" href="https://fonts.googleapis.com">
   <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
   <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500;600;700&display=swap"
      rel="stylesheet">
   <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
   <style>
      .admin-container {
         max-width: 1200px;
         margin: 2rem auto;
         padding: 2rem;
         background: var(--glass-bg);
         backdrop-filter: blur(10px);
         border: 1px solid var(--glass-border);
         border-radius: 8px;
      }

      .admin-header {
         text-align: center;
         margin-bottom: 2rem;
         color: var(--text-primary);
      }

      .admin-stats {
         display: grid;
         grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
         gap: 1rem;
         margin-bottom: 2rem;
      }

      .stat-card {
         background: var(--bg-secondary);
         padding: 1.5rem;
         border-radius: 8px;
         border: 1px solid var(--glass-border);
         text-align: center;
      }

      .stat-card h3 {
         color: var(--text-primary);
         margin-bottom: 0.5rem;
      }

      .stat-card .number {
         font-size: 2rem;
         font-weight: bold;
         color: var(--accent-color);
      }

      .admin-section {
         margin-bottom: 2rem;
         background: var(--bg-secondary);
         padding: 1.5rem;
         border-radius: 8px;
         border: 1px solid var(--glass-border);
      }

      .admin-section h3 {
         color: var(--text-primary);
         margin-bottom: 1rem;
      }

      .contact-list {
         max-height: 400px;
         overflow-y: auto;
      }

      .contact-item {
         background: var(--bg-tertiary);
         padding: 1rem;
         margin-bottom: 1rem;
         border-radius: 4px;
         border-left: 3px solid var(--text-primary);
      }

      .contact-item.unread {
         border-left-color: var(--accent-color);
      }

      .contact-meta {
         display: flex;
         justify-content: space-between;
         align-items: center;
         margin-bottom: 0.5rem;
         font-size: 0.9rem;
         color: var(--text-muted);
      }

      .login-form {
         max-width: 400px;
         margin: 2rem auto;
         padding: 2rem;
         background: var(--glass-bg);
         backdrop-filter: blur(10px);
         border: 1px solid var(--glass-border);
         border-radius: 8px;
      }

      .hidden {
         display: none;
      }

      .chart-container {
         height: 300px;
         margin-top: 1rem;
      }
   </style>
</head>

<body>
   <!-- Login Form -->
   <div id="loginSection" class="login-form">
      <h2 style="color: var(--text-primary); text-align: center; margin-bottom: 1.5rem;">
         <i class="fas fa-terminal"></i> Admin Login
      </h2>
      <form id="loginForm">
         <div class="form-group">
            <label for="email">Email:</label>
            <input type="email" id="email" name="email" required>
         </div>
         <div class="form-group">
            <label for="password">Password:</label>
            <input type="password" id="password" name="password" required>
         </div>
         <button type="submit" class="submit-btn" style="width: 100%;">
            <i class="fas fa-sign-in-alt"></i>
            Login
         </button>
      </form>
   </div>

   <!-- Admin Dashboard -->
   <div id="adminDashboard" class="admin-container hidden">
      <div class="admin-header">
         <h1><i class="fas fa-tachometer-alt"></i> Portfolio Analytics Dashboard</h1>
         <button id="logoutBtn" class="submit-btn" style="margin-top: 1rem;">
            <i class="fas fa-sign-out-alt"></i> Logout
         </button>
      </div>

      <!-- Statistics Cards -->
      <div class="admin-stats">
         <div class="stat-card">
            <h3>Total Views</h3>
            <div class="number" id="totalViews">---</div>
         </div>
         <div class="stat-card">
            <h3>Unique Visitors</h3>
            <div class="number" id="uniqueVisitors">---</div>
         </div>
         <div class="stat-card">
            <h3>Contact Submissions</h3>
            <div class="number" id="contactSubmissions">---</div>
         </div>
         <div class="stat-card">
            <h3>Project Clicks</h3>
            <div class="number" id="projectClicks">---</div>
         </div>
      </div>

      <!-- Contact Submissions -->
      <div class="admin-section">
         <h3><i class="fas fa-envelope"></i> Recent Contact Submissions</h3>
         <div id="contactList" class="contact-list">
            <p style="color: var(--text-muted);">Loading contact submissions...</p>
         </div>
      </div>

      <!-- Popular Projects -->
      <div class="admin-section">
         <h3><i class="fas fa-chart-bar"></i> Project Analytics</h3>
         <div id="projectAnalytics">
            <p style="color: var(--text-muted);">Loading project analytics...</p>
         </div>
      </div>

      <!-- Skill Feedback -->
      <div class="admin-section">
         <h3><i class="fas fa-star"></i> Skill Feedback</h3>
         <div id="skillFeedback">
            <p style="color: var(--text-muted);">Loading skill feedback...</p>
         </div>
      </div>
   </div>

   <!-- Supabase Configuration -->
   <script type="module">
      import { portfolioDb, portfolioAuth } from './supabase-config.js';

      window.portfolioDb = portfolioDb;
      window.portfolioAuth = portfolioAuth;

      // Initialize admin dashboard
      initializeAdmin();
   </script>

   <script>
      async function initializeAdmin() {
         // Check if user is already logged in
         const isAdmin = await window.portfolioAuth.isAdmin();
         if (isAdmin) {
            showDashboard();
            loadDashboardData();
         }

         // Login form handler
         document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;

            const result = await window.portfolioAuth.adminSignIn(email, password);

            if (result.success) {
               const isAdmin = await window.portfolioAuth.isAdmin();
               if (isAdmin) {
                  showDashboard();
                  loadDashboardData();
               } else {
                  alert('Access denied. Admin privileges required.');
               }
            } else {
               alert('Login failed: ' + result.error);
            }
         });

         // Logout handler
         document.getElementById('logoutBtn').addEventListener('click', async () => {
            await window.portfolioAuth.signOut();
            hideDashboard();
         });
      }

      function showDashboard() {
         document.getElementById('loginSection').classList.add('hidden');
         document.getElementById('adminDashboard').classList.remove('hidden');
      }

      function hideDashboard() {
         document.getElementById('loginSection').classList.remove('hidden');
         document.getElementById('adminDashboard').classList.add('hidden');
      }

      async function loadDashboardData() {
         try {
            // Load analytics
            const analytics = await window.portfolioDb.getAnalytics();
            if (analytics.success) {
               document.getElementById('totalViews').textContent = analytics.data.totalViews;
               document.getElementById('uniqueVisitors').textContent = analytics.data.uniqueVisitors;
               document.getElementById('contactSubmissions').textContent = analytics.data.contactSubmissions;
            }

            // Load contact submissions
            await loadContactSubmissions();

            // Load project analytics
            await loadProjectAnalytics();

            // Load skill feedback
            await loadSkillFeedback();

         } catch (error) {
            console.error('Error loading dashboard data:', error);
         }
      }

      async function loadContactSubmissions() {
         // This would use a custom query to get contact submissions
         // For now, we'll show a placeholder
         const contactList = document.getElementById('contactList');
         contactList.innerHTML = `
                <div class="contact-item">
                    <div class="contact-meta">
                        <span><strong>Sample User</strong> (sample@email.com)</span>
                        <span>2 hours ago</span>
                    </div>
                    <p>This is a sample contact message. Actual messages will appear here when Supabase is configured.</p>
                </div>
            `;
      }

      async function loadProjectAnalytics() {
         const projectAnalytics = document.getElementById('projectAnalytics');
         projectAnalytics.innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                    <div class="stat-card">
                        <h4 style="color: var(--text-primary);">AutoHawk Orchestrator</h4>
                        <div style="color: var(--accent-color); font-size: 1.5rem;">42 clicks</div>
                    </div>
                    <div class="stat-card">
                        <h4 style="color: var(--text-primary);">DNS Resolver</h4>
                        <div style="color: var(--accent-color); font-size: 1.5rem;">28 clicks</div>
                    </div>
                    <div class="stat-card">
                        <h4 style="color: var(--text-primary);">Orchestrator AI</h4>
                        <div style="color: var(--accent-color); font-size: 1.5rem;">35 clicks</div>
                    </div>
                </div>
            `;
      }

      async function loadSkillFeedback() {
         const skillFeedback = document.getElementById('skillFeedback');
         skillFeedback.innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem;">
                    <div class="stat-card">
                        <h4 style="color: var(--text-primary);">Python</h4>
                        <div style="color: var(--terminal-green); font-size: 1.2rem;">★★★★★ 4.8</div>
                        <small style="color: var(--text-muted);">12 ratings</small>
                    </div>
                    <div class="stat-card">
                        <h4 style="color: var(--text-primary);">Cybersecurity</h4>
                        <div style="color: var(--terminal-green); font-size: 1.2rem;">★★★★★ 4.9</div>
                        <small style="color: var(--text-muted);">8 ratings</small>
                    </div>
                    <div class="stat-card">
                        <h4 style="color: var(--text-primary);">Docker</h4>
                        <div style="color: var(--terminal-green); font-size: 1.2rem;">★★★★☆ 4.2</div>
                        <small style="color: var(--text-muted);">6 ratings</small>
                    </div>
                </div>
            `;
      }

      // Refresh data every 30 seconds
      setInterval(loadDashboardData, 30000);
   </script>
</body>

</html>